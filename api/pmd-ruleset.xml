<?xml version="1.0"?>
<ruleset name="Custom PMD Ruleset"
         xmlns="http://pmd.sourceforge.net/ruleset/2.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://pmd.sourceforge.net/ruleset/2.0.0 https://pmd.sourceforge.io/ruleset_2_0_0.xsd">

  <description>
    Custom PMD ruleset for SchemaSculpt API - High quality but pragmatic rules
  </description>

  <!-- ============================================ -->
  <!-- Best Practices                               -->
  <!-- ============================================ -->
  <rule ref="category/java/bestpractices.xml">
    <!-- Exclude rules incompatible with Spring Boot -->
    <exclude name="GuardLogStatement"/><!-- Spring Boot logging is optimized -->
    <exclude name="AvoidReassigningParameters"/><!-- Common in builders/validators -->
    <exclude name="AvoidUncheckedExceptionsInSignatures"/><!-- Spring uses unchecked exceptions -->
    <exclude name="UnusedAssignment"/><!-- Common in initialization patterns -->
    <exclude name="PreserveStackTrace"/><!-- Some exceptions are intentionally wrapped -->
    <exclude name="LooseCoupling"/><!-- Interface-based programming not always needed -->
    <exclude name="LiteralsFirstInComparisons"/><!-- Modern style uses natural order -->
    <exclude name="UnusedLocalVariable"/><!-- IDE handles this -->
    <exclude name="UnusedFormalParameter"/><!-- Interface implementations -->
    <exclude name="UseVarargs"/><!-- Sometimes arrays are clearer -->
  </rule>

  <!-- ============================================ -->
  <!-- Code Style                                   -->
  <!-- ============================================ -->
  <rule ref="category/java/codestyle.xml">
    <!-- Exclude overly pedantic rules -->
    <exclude name="LocalVariableCouldBeFinal"/>
    <exclude name="MethodArgumentCouldBeFinal"/>
    <exclude name="OnlyOneReturn"/><!-- Multiple returns improve readability -->
    <exclude name="AtLeastOneConstructor"/><!-- Lombok and Spring handle this -->
    <exclude name="CommentDefaultAccessModifier"/>
    <exclude name="CallSuperInConstructor"/>
    <exclude name="UseExplicitTypes"/><!-- var is acceptable in modern Java -->
    <exclude name="LiteralsFirstInComparisons"/><!-- Modern style uses natural order -->
    <exclude name="FieldNamingConventions"/><!-- Lombok generates fields -->
    <exclude name="UselessParentheses"/><!-- Sometimes improves readability -->
    <!-- Keep important naming/style checks but allow flexibility -->
    <exclude name="ShortVariable"/><!-- Single-letter variables OK in lambdas/loops -->
    <exclude name="LongVariable"/><!-- Descriptive names are valuable -->
    <exclude name="ShortClassName"/>
    <exclude name="ControlStatementBraces"/><!-- Checkstyle handles brace style -->
    <exclude name="UnnecessaryCast"/><!-- Sometimes needed for clarity -->
    <exclude name="ConfusingTernary"/><!-- Often more readable -->
    <exclude name="MethodNamingConventions"/><!-- Test methods have descriptive names -->
    <exclude name="FieldDeclarationsShouldBeAtStartOfClass"/><!-- Lombok fields are OK elsewhere -->
    <exclude name="ClassNamingConventions"/><!-- Allow test naming patterns -->
    <exclude name="PrematureDeclaration"/><!-- Sometimes improves clarity -->
    <exclude name="UnnecessaryLocalBeforeReturn"/><!-- Sometimes improves debugging -->
    <exclude name="BooleanGetMethodName"/><!-- is/get both acceptable -->
    <exclude name="LambdaCanBeMethodReference"/><!-- Lambdas often more readable -->
    <exclude name="UseUnderscoresInNumericLiterals"/><!-- Not required -->
  </rule>

  <!-- ============================================ -->
  <!-- Design                                       -->
  <!-- ============================================ -->
  <rule ref="category/java/design.xml">
    <!-- Exclude rules that conflict with modern frameworks -->
    <exclude name="LawOfDemeter"/><!-- Too strict for Spring/Lombok -->
    <exclude name="LoosePackageCoupling"/>
    <exclude name="UseUtilityClass"/><!-- Spring components aren't utility classes -->
    <exclude name="DataClass"/><!-- DTOs are intentionally data classes -->
    <exclude name="AvoidThrowingRawExceptionTypes"/><!-- RuntimeException is standard in Spring -->
    <exclude name="ExceptionAsFlowControl"/><!-- Valid for validation logic -->
    <exclude name="GodClass"/><!-- Some service classes are naturally large -->
    <exclude name="TooManyMethods"/>
    <exclude name="AvoidCatchingGenericException"/><!-- Common in controllers/global handlers -->
    <exclude name="SignatureDeclareThrowsException"/><!-- Spring uses runtime exceptions -->
    <exclude name="AvoidDeeplyNestedIfStmts"/><!-- Some complex logic needs nesting -->
    <exclude name="SimplifyBooleanReturns"/><!-- Sometimes more explicit is clearer -->
    <exclude name="ExcessiveImports"/><!-- Large services need many imports -->
    <exclude name="CouplingBetweenObjects"/><!-- Spring services are naturally coupled -->
    <exclude name="TooManyFields"/><!-- DTOs and entities may have many fields -->
    <exclude name="CollapsibleIfStatements"/><!-- Sometimes separate ifs are clearer -->
    <exclude name="UseObjectForClearerAPI"/><!-- Method overloading is fine -->
    <exclude name="ClassWithOnlyPrivateConstructorsShouldBeFinal"/><!-- Spring proxies need non-final -->
    <exclude name="SimplifyConditional"/><!-- Sometimes explicit is better -->
    <exclude name="CyclomaticComplexity"/><!-- Handled separately with threshold -->
    <exclude name="CognitiveComplexity"/><!-- Handled separately with threshold -->
    <exclude name="NPathComplexity"/><!-- Handled separately with threshold -->
  </rule>

  <!-- Align complexity thresholds with checkstyle (relaxed for now) -->
  <rule ref="category/java/design.xml/CyclomaticComplexity">
    <properties>
      <property name="methodReportLevel" value="25"/><!-- Relaxed threshold -->
      <property name="classReportLevel" value="80"/>
    </properties>
  </rule>

  <rule ref="category/java/design.xml/CognitiveComplexity">
    <properties>
      <property name="reportLevel" value="35"/><!-- Relaxed threshold -->
    </properties>
  </rule>

  <rule ref="category/java/design.xml/NPathComplexity">
    <properties>
      <property name="reportLevel" value="800"/><!-- Relaxed threshold -->
    </properties>
  </rule>

  <!-- ============================================ -->
  <!-- Error Prone                                  -->
  <!-- ============================================ -->
  <rule ref="category/java/errorprone.xml">
    <!-- Keep most error-prone checks, exclude only specific cases -->
    <exclude name="AvoidDuplicateLiterals"/><!-- Constants/config may duplicate strings -->
    <exclude name="NullAssignment"/><!-- Sometimes needed for explicit cleanup -->
    <exclude name="TestClassWithoutTestCases"/><!-- Base test classes are valid -->
    <exclude name="UseLocaleWithCaseConversions"/><!-- Default locale often acceptable -->
    <exclude name="AvoidUsingHardCodedIP"/><!-- localhost/test IPs are acceptable -->
    <exclude name="MissingSerialVersionUID"/><!-- Not critical for DTOs -->
    <exclude name="NonExhaustiveSwitch"/><!-- Default case handles this -->
    <exclude name="AvoidLiteralsInIfCondition"/><!-- Literals like 0, 1, "" are common -->
    <exclude name="AvoidInstanceofChecksInCatchClause"/><!-- Sometimes needed for exception handling -->
    <exclude name="AvoidFieldNameMatchingMethodName"/><!-- Common in builders -->
    <exclude name="UnusedLocalVariable"/><!-- Lombok may generate -->
    <exclude name="UnusedFormalParameter"/><!-- Interface implementations may not use all params -->
    <exclude name="UseVarargs"/><!-- Arrays are sometimes clearer -->
  </rule>

  <!-- ============================================ -->
  <!-- Multithreading                               -->
  <!-- ============================================ -->
  <rule ref="category/java/multithreading.xml">
    <exclude name="UseConcurrentHashMap"/><!-- Not needed in single-threaded contexts -->
    <exclude name="DoNotUseThreads"/><!-- Spring Boot virtual threads require this -->
  </rule>

  <!-- ============================================ -->
  <!-- Performance                                  -->
  <!-- ============================================ -->
  <rule ref="category/java/performance.xml">
    <exclude name="AvoidInstantiatingObjectsInLoops"/><!-- Modern JVM optimizes this -->
    <exclude name="InefficientEmptyStringCheck"/><!-- JVM inlines equals("") -->
    <exclude name="UseStringBufferForStringAppends"/><!-- Modern JVM optimizes concatenation -->
    <exclude name="UseIndexOfChar"/><!-- Minor optimization -->
  </rule>

  <!-- ============================================ -->
  <!-- Security - Keep All (Critical)               -->
  <!-- ============================================ -->
  <rule ref="category/java/security.xml">
    <exclude name="HardCodedCryptoKey"/><!-- Test/dev configs may have hardcoded keys -->
  </rule>

  <!-- ============================================ -->
  <!-- Documentation                                -->
  <!-- ============================================ -->
  <rule ref="category/java/documentation.xml">
    <exclude name="CommentRequired"/><!-- Checkstyle handles Javadoc requirements -->
    <exclude name="CommentSize"/><!-- Checkstyle handles line length -->
  </rule>

</ruleset>
